<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡¨ç™½é¡µé¢é…ç½®ä¸­å¿ƒ ğŸ’•</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh; padding: 20px;
        }
        .container {
            max-width: 900px; margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px; padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        h1 { text-align: center; color: #667eea; margin-bottom: 10px; font-size: 2rem; }
        .subtitle { text-align: center; color: #999; margin-bottom: 30px; font-size: 0.9rem; }
        .section { margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px; }
        .section-title { color: #667eea; font-size: 1.2rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
        .form-group { margin-bottom: 15px; }
        label { display: block; color: #555; margin-bottom: 5px; font-weight: 500; }
        input[type="text"], textarea, select {
            width: 100%; padding: 12px; border: 2px solid #e0e0e0;
            border-radius: 10px; font-size: 1rem; transition: border-color 0.3s; font-family: inherit;
        }
        input[type="text"]:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
        textarea { min-height: 100px; resize: vertical; }
        .color-picker-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .color-item { display: flex; align-items: center; gap: 10px; }
        .color-item input[type="color"] { width: 50px; height: 40px; border: none; border-radius: 8px; cursor: pointer; }
        .effects-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; }
        .effect-item { display: flex; align-items: center; gap: 8px; padding: 10px; background: white; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .effect-item:hover { background: #667eea; color: white; }
        .effect-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        .btn {
            padding: 12px 30px; border: none; border-radius: 25px;
            font-size: 1rem; cursor: pointer; transition: all 0.3s; font-weight: bold; margin: 5px;
        }
        .btn-primary { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5); }
        .btn-success { background: linear-gradient(45deg, #ff6b6b, #ff8e8e); color: white; }
        .btn-success:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255, 107, 107, 0.5); }
        .btn-secondary { background: #e0e0e0; color: #555; }
        .btn-secondary:hover { background: #d0d0d0; }
        .btn-danger { background: #ff6b6b; color: white; }
        .button-group { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
        .link-display { background: white; padding: 15px; border-radius: 10px; margin-top: 15px; word-break: break-all; border: 2px dashed #667eea; }
        .link-display a { color: #667eea; text-decoration: none; font-weight: 500; }
        .link-display a:hover { text-decoration: underline; }
        .token-input-group { display: flex; gap: 10px; }
        .token-input-group input { flex: 1; }
        .saved-list { margin-top: 20px; }
        .saved-item { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .saved-item-info { flex: 1; }
        .saved-item-token { font-weight: bold; color: #667eea; }
        .saved-item-date { font-size: 0.85rem; color: #999; }
        .toast {
            position: fixed; top: 20px; right: 20px; padding: 15px 25px;
            background: #4caf50; color: white; border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            transform: translateX(400px); transition: transform 0.3s; z-index: 1000;
        }
        .toast.show { transform: translateX(0); }
        .toast.error { background: #f44336; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 10px 20px; background: #e0e0e0; border: none; border-radius: 20px; cursor: pointer; transition: all 0.3s; font-weight: 500; }
        .tab.active { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        @media (max-width: 768px) {
            .container { padding: 20px; }
            h1 { font-size: 1.5rem; }
            .section { padding: 15px; }
            .button-group { flex-direction: column; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’• è¡¨ç™½é¡µé¢é…ç½®ä¸­å¿ƒ</h1>
        <p class="subtitle">åˆ›å»ºä¸“å±äºä½ çš„è¡¨ç™½é¡µé¢ï¼Œè®©çˆ±æ„æ›´åŠ ç‹¬ç‰¹</p>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('create')">åˆ›å»ºæ–°é…ç½®</button>
            <button class="tab" onclick="switchTab('manage')">ç®¡ç†å·²ä¿å­˜</button>
        </div>

        <div id="create-tab" class="tab-content active">
            <div class="section">
                <h3 class="section-title">ğŸ”‘ å£ä»¤è®¾ç½®</h3>
                <div class="form-group">
                    <label>è¾“å…¥å£ä»¤ï¼ˆç”¨äºç”Ÿæˆä¸“å±é“¾æ¥ï¼‰</label>
                    <div class="token-input-group">
                        <input type="text" id="token" placeholder="ä¾‹å¦‚ï¼šlove2024ã€mylove123ã€5201314">
                        <button class="btn btn-secondary" onclick="generateRandomToken()">éšæœºç”Ÿæˆ</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">ğŸ’¬ è¯­å¥é…ç½®</h3>
                <div class="form-group">
                    <label>è¡¨ç™½é—®é¢˜</label>
                    <input type="text" id="question" placeholder="åšæˆ‘å¥³æœ‹å‹å¥½ä¸å¥½ï¼ŸğŸ’•">
                </div>
                <div class="form-group">
                    <label>åŒæ„æŒ‰é’®æ–‡å­—</label>
                    <input type="text" id="yesText" placeholder="åŒæ„ â¤ï¸">
                </div>
                <div class="form-group">
                    <label>æ‹’ç»æŒ‰é’®æ–‡å­—</label>
                    <input type="text" id="noText" placeholder="æ‹’ç» ğŸ˜¢">
                </div>
                <div class="form-group">
                    <label>æˆåŠŸæ ‡é¢˜</label>
                    <input type="text" id="successTitle" placeholder="ğŸ‰ è€¶ï¼æˆ‘å°±çŸ¥é“ä½ ä¼šåŒæ„çš„ï¼ğŸ‰">
                </div>
                <div class="form-group">
                    <label>æˆåŠŸæ¶ˆæ¯</label>
                    <input type="text" id="successMessage" placeholder="å·¥èµ„ä¸Šäº¤ï¼Œå®¶åŠ¡å…¨åŒ…ï¼â¤ï¸">
                </div>
                <div class="form-group">
                    <label>æç¤ºè¯­ï¼ˆæ¯è¡Œä¸€æ¡ï¼Œæ”¯æŒ {attempts} å ä½ç¬¦ï¼‰</label>
                    <textarea id="hints" placeholder="ğŸ’¡ è¯•è¯•ç‚¹å‡»"æ‹’ç»"æŒ‰é’®çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ~"></textarea>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">ğŸ¨ ä¸»é¢˜é¢œè‰²</h3>
                <div class="color-picker-group">
                    <div class="color-item">
                        <input type="color" id="primaryColor" value="#667eea">
                        <label>ä¸»è‰²è°ƒ</label>
                    </div>
                    <div class="color-item">
                        <input type="color" id="secondaryColor" value="#764ba2">
                        <label>æ¬¡è¦è‰²</label>
                    </div>
                    <div class="color-item">
                        <input type="color" id="accentColor" value="#f093fb">
                        <label>å¼ºè°ƒè‰²</label>
                    </div>
                    <div class="color-item">
                        <input type="color" id="yesButtonColor" value="#ff6b6b">
                        <label>åŒæ„æŒ‰é’®</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">âœ¨ ç‰¹æ•ˆé€‰æ‹©</h3>
                <div class="effects-grid">
                    <label class="effect-item"><input type="checkbox" id="effect-hearts" checked><span>ğŸ’• çˆ±å¿ƒé£˜è½</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-stars" checked><span>â­ æ˜Ÿæ˜Ÿé—ªçƒ</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-confetti" checked><span>ğŸŠ å½©çº¸åº†ç¥</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-fireworks"><span>ğŸ† çƒŸèŠ±ç»½æ”¾</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-bubbles"><span>ğŸ«§ æ°”æ³¡ä¸Šå‡</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-rainbow"><span>ğŸŒˆ å½©è™¹å…‰æ•ˆ</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-snow"><span>â„ï¸ é›ªèŠ±é£˜è½</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-petals"><span>ğŸŒ¸ èŠ±ç“£é£˜è½</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-meteor"><span>â˜„ï¸ æµæ˜Ÿåˆ’è¿‡</span></label>
                    <label class="effect-item"><input type="checkbox" id="effect-lightning"><span>âš¡ é—ªç”µæ•ˆæœ</span></label>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">âš™ï¸ å…¶ä»–è®¾ç½®</h3>
                <div class="form-group">
                    <label class="effect-item">
                        <input type="checkbox" id="showAdminLink" checked>
                        <span>æ˜¾ç¤ºé…ç½®ä¸­å¿ƒå…¥å£</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>æ‹’ç»è§¦å‘ç‰¹æ•ˆæ¬¡æ•°</label>
                    <input type="number" id="triggerCount" value="5" min="1" max="100" style="width: 100px;">
                    <span style="color: #999; font-size: 0.9rem; margin-left: 10px;">æ¬¡åè§¦å‘æœ‰è¶£çš„æ•ˆæœ</span>
                </div>
                <div class="form-group">
                    <label>èº²é¿æ£€æµ‹èŒƒå›´</label>
                    <input type="number" id="avoidDistance" value="100" min="50" max="300" style="width: 100px;">
                    <span style="color: #999; font-size: 0.9rem; margin-left: 10px;">pxï¼ˆé¼ æ ‡é è¿‘æŒ‰é’®å¤šå°‘åƒç´ è§¦å‘èº²é¿ï¼‰</span>
                </div>
                <div class="form-group">
                    <label class="effect-item">
                        <input type="checkbox" id="effect-shake" checked>
                        <span>ğŸ“³ æ‹’ç»æ—¶éœ‡åŠ¨å±å¹•</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="effect-item">
                        <input type="checkbox" id="effect-sound" checked>
                        <span>ğŸ”Š æ‹’ç»æ—¶æ’­æ”¾éŸ³æ•ˆ</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="effect-item">
                        <input type="checkbox" id="effect-cry" checked>
                        <span>ğŸ˜¢ æ‹’ç»æŒ‰é’®å“­æ³£æ•ˆæœ</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="effect-item">
                        <input type="checkbox" id="effect-runaway">
                        <span>ğŸƒ æ‹’ç»æŒ‰é’®è¶Šè·‘è¶Šå¿«</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="effect-item">
                        <input type="checkbox" id="effect-multiple" checked>
                        <span>ğŸ‘¥ æ‹’ç»æŒ‰é’®åˆ†èº«æœ¯</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="effect-item">
                        <input type="checkbox" id="effect-invert" checked>
                        <span>ğŸ­ æ‹’ç»æŒ‰é’®åè‰²</span>
                    </label>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button class="btn btn-success" onclick="previewConfig()">ğŸ‘ï¸ é¢„è§ˆæ•ˆæœ</button>
                <button class="btn btn-info" onclick="generateShareLink()">ğŸ”— ç”Ÿæˆåˆ†äº«é“¾æ¥</button>
                <button class="btn btn-secondary" onclick="resetForm()">ğŸ”„ é‡ç½®è¡¨å•</button>
            </div>

            <div class="link-display" id="linkDisplay" style="display: none;">
                <strong>ä½ çš„ä¸“å±é“¾æ¥ï¼š</strong><br>
                <a id="generatedLink" href="#" target="_blank"></a>
            </div>
        </div>

        <div id="manage-tab" class="tab-content">
            <div class="section">
                <h3 class="section-title">ğŸ“‹ å·²ä¿å­˜çš„é…ç½®</h3>
                <div style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="exportAllConfigs()">ğŸ“¤ å¯¼å‡ºå…¨éƒ¨é…ç½®</button>
                    <button class="btn btn-success" onclick="document.getElementById('importFile').click()">ğŸ“¥ å¯¼å…¥é…ç½®</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importConfig(event)">
                </div>
                <div id="savedList" class="saved-list">
                    <p style="color: #999; text-align: center;">æš‚æ— ä¿å­˜çš„é…ç½®</p>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <!-- å°è¯•ä»CDNåŠ è½½LZStringå‹ç¼©åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.5.0/lz-string.min.js"></script>
    <script>
        // å¦‚æœCDNåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨ç®€åŒ–çš„Base64å›é€€æ–¹æ¡ˆ
        if (typeof LZString === 'undefined') {
            LZString = {
                compressToEncodedURIComponent: function(input) {
                    if (input == null) return "";
                    var encoded = btoa(unescape(encodeURIComponent(input)));
                    return encoded.replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
                },
                decompressFromEncodedURIComponent: function(input) {
                    if (input == null || input === "") return null;
                    try {
                        input = input.replace(/-/g, '+').replace(/_/g, '/');
                        while (input.length % 4) input += '=';
                        return decodeURIComponent(escape(atob(input)));
                    } catch (e) {
                        return null;
                    }
                }
            };
        }

        /** é”®åæ˜ å°„è¡¨ - ç”¨äºç¼©çŸ­URL */
        const KEY_MAP = {
            question: 'q', yesText: 'y', noText: 'n', successTitle: 'st',
            successMessage: 'sm', hints: 'h', theme: 't', primaryColor: 'pc',
            secondaryColor: 'sc', accentColor: 'ac', yesButtonColor: 'ybc',
            effects: 'e', hearts: 'ht', stars: 'sr', confetti: 'cf', fireworks: 'fw',
            bubbles: 'bb', rainbow: 'rb', snow: 'sn', petals: 'pt', meteors: 'mt',
            lightning: 'lt', triggerEffects: 'te', triggerCount: 'tc', avoidDistance: 'ad', shake: 'sk',
            sound: 'sd', cry: 'cr', runAway: 'ra', multiple: 'ml', invert: 'iv',
            showAdminLink: 'sal'
        };
        const REVERSE_KEY_MAP = Object.fromEntries(Object.entries(KEY_MAP).map(([k, v]) => [v, k]));
        
        /** é»˜è®¤å€¼ */
        const defaultHints = `ğŸ’¡ è¯•è¯•ç‚¹å‡»"æ‹’ç»"æŒ‰é’®çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ~
ğŸ˜ æƒ³è·‘ï¼Ÿæ²¡é‚£ä¹ˆå®¹æ˜“ï¼
ğŸ¤­ åˆ«æŒ£æ‰äº†ï¼Œæ²¡ç”¨çš„~
ğŸ˜… ä½ å·²ç»å°è¯• {attempts} æ¬¡äº†å“¦~
ğŸ¥º ç»™æˆ‘ä¸€ä¸ªæœºä¼šå˜›~
ğŸ’• æˆ‘ä¼šå¯¹ä½ å¾ˆå¥½çš„ï¼
ğŸ æˆ‘ä¼šç»™ä½ ä¹°å¥½åƒçš„ï¼
ğŸ  æˆ¿äº§è¯å†™ä½ åå­—ï¼
ğŸ’° å·¥èµ„å¡äº¤ç»™ä½ ç®¡ï¼
ğŸ³ æˆ‘ä¼šåšé¥­ç»™ä½ åƒï¼
ğŸ§¹ å®¶åŠ¡æˆ‘å…¨åŒ…äº†ï¼
ğŸ¶ æˆ‘ä¼šåƒå°ç‹—ä¸€æ ·å¬è¯ï¼
ğŸ’ª æˆ‘ä¼šä¿æŠ¤ä½ çš„ï¼
ğŸŒŸ ä½ å°±æ˜¯æˆ‘çš„å°æ˜Ÿæ˜Ÿï¼
ğŸ˜Š ç­”åº”æˆ‘å˜›~`;

        /** åˆå§‹åŒ– */
        document.addEventListener('DOMContentLoaded', () => { loadSavedList(); loadDefaultValues(); });

        /** åŠ è½½é»˜è®¤å€¼ */
        function loadDefaultValues() {
            document.getElementById('question').value = 'åšæˆ‘å¥³æœ‹å‹å¥½ä¸å¥½ï¼ŸğŸ’•';
            document.getElementById('yesText').value = 'åŒæ„ â¤ï¸';
            document.getElementById('noText').value = 'æ‹’ç» ğŸ˜¢';
            document.getElementById('successTitle').value = 'ğŸ‰ è€¶ï¼æˆ‘å°±çŸ¥é“ä½ ä¼šåŒæ„çš„ï¼ğŸ‰';
            document.getElementById('successMessage').value = 'å·¥èµ„ä¸Šäº¤ï¼Œå®¶åŠ¡å…¨åŒ…ï¼â¤ï¸';
            document.getElementById('hints').value = defaultHints;
        }

        /** åˆ‡æ¢æ ‡ç­¾ */
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            if (tabName === 'manage') loadSavedList();
        }

        /** ç”Ÿæˆéšæœºå£ä»¤ */
        function generateRandomToken() {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            document.getElementById('token').value = Array(8).fill(0).map(() => chars[Math.floor(Math.random() * chars.length)]).join('');
        }

        /** è·å–è¡¨å•é…ç½® */
        function getConfigFromForm() {
            const hintsText = document.getElementById('hints').value;
            return {
                question: document.getElementById('question').value,
                yesText: document.getElementById('yesText').value,
                noText: document.getElementById('noText').value,
                successTitle: document.getElementById('successTitle').value,
                successMessage: document.getElementById('successMessage').value,
                hints: hintsText.split('\n').filter(h => h.trim()),
                theme: {
                    primaryColor: document.getElementById('primaryColor').value,
                    secondaryColor: document.getElementById('secondaryColor').value,
                    accentColor: document.getElementById('accentColor').value,
                    yesButtonColor: document.getElementById('yesButtonColor').value
                },
                effects: {
                    hearts: document.getElementById('effect-hearts').checked,
                    stars: document.getElementById('effect-stars').checked,
                    confetti: document.getElementById('effect-confetti').checked,
                    fireworks: document.getElementById('effect-fireworks').checked,
                    bubbles: document.getElementById('effect-bubbles').checked,
                    rainbow: document.getElementById('effect-rainbow').checked,
                    snow: document.getElementById('effect-snow').checked,
                    petals: document.getElementById('effect-petals').checked,
                    meteor: document.getElementById('effect-meteor').checked,
                    lightning: document.getElementById('effect-lightning').checked
                },
                triggerEffects: {
                    triggerCount: parseInt(document.getElementById('triggerCount').value) || 5,
                    avoidDistance: parseInt(document.getElementById('avoidDistance').value) || 100,
                    shake: document.getElementById('effect-shake').checked,
                    sound: document.getElementById('effect-sound').checked,
                    cry: document.getElementById('effect-cry').checked,
                    runaway: document.getElementById('effect-runaway').checked,
                    multiple: document.getElementById('effect-multiple').checked,
                    invert: document.getElementById('effect-invert').checked
                },
                showAdminLink: document.getElementById('showAdminLink').checked,
                createdAt: new Date().toISOString()
            };
        }

        /** ä¿å­˜é…ç½® */
        function saveConfig() {
            const token = document.getElementById('token').value.trim();
            if (!token) return showToast('è¯·è¾“å…¥å£ä»¤ï¼', true);
            if (!/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(token)) return showToast('å£ä»¤åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸­æ–‡ï¼', true);

            const config = getConfigFromForm();
            const allConfigs = JSON.parse(localStorage.getItem('loveConfigs') || '{}');
            allConfigs[token] = config;
            localStorage.setItem('loveConfigs', JSON.stringify(allConfigs));

            const baseUrl = window.location.origin + window.location.pathname.replace('admin.html', 'index.html');
            const link = `${baseUrl}?t=${encodeURIComponent(token)}`;
            
            document.getElementById('generatedLink').href = link;
            document.getElementById('generatedLink').textContent = link;
            document.getElementById('linkDisplay').style.display = 'block';

            showToast('é…ç½®ä¿å­˜æˆåŠŸï¼');
            loadSavedList();
        }

        /** é¢„è§ˆ */
        function previewConfig() {
            const config = getConfigFromForm();
            const configStr = encodeURIComponent(JSON.stringify(config));
            const baseUrl = window.location.origin + window.location.pathname.replace('admin.html', 'index.html');
            window.open(`${baseUrl}?preview=${configStr}`, '_blank');
        }

        /** Unicodeè½¬Base64 - å¤„ç†ä¸­æ–‡ */
        function btoaUnicode(str) {
            return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
                function toSolidBytes(match, p1) {
                    return String.fromCharCode('0x' + p1);
            }));
        }

        /** ç”Ÿæˆåˆ†äº«é“¾æ¥ - å¯åˆ†äº«ç»™å…¶ä»–äºº */
        function generateShareLink() {
            const config = getConfigFromForm();
            // ç§»é™¤ createdAt å­—æ®µï¼ˆä¸éœ€è¦åˆ†äº«ï¼‰
            const { createdAt, ...shareConfig } = config;
            
            // ä½¿ç”¨çŸ­é”®åå‹ç¼© JSON
            const shortConfig = {};
            for (const [key, value] of Object.entries(shareConfig)) {
                shortConfig[KEY_MAP[key] || key] = value;
            }
            
            const jsonStr = JSON.stringify(shortConfig);
            // ä½¿ç”¨LZStringå‹ç¼©
            const compressed = LZString.compressToEncodedURIComponent(jsonStr);
            const baseUrl = window.location.origin + window.location.pathname.replace('admin.html', 'index.html');
            const shareLink = `${baseUrl}?c=${compressed}`;
            
            document.getElementById('generatedLink').href = shareLink;
            document.getElementById('generatedLink').textContent = shareLink;
            document.getElementById('linkDisplay').style.display = 'block';
            
            showToast('åˆ†äº«é“¾æ¥ç”ŸæˆæˆåŠŸï¼');
        }

        /** é‡ç½® */
        function resetForm() {
            loadDefaultValues();
            document.getElementById('token').value = '';
            document.getElementById('linkDisplay').style.display = 'none';
            ['primaryColor', 'secondaryColor', 'accentColor', 'yesButtonColor'].forEach(id => {
                document.getElementById(id).value = { primaryColor: '#667eea', secondaryColor: '#764ba2', accentColor: '#f093fb', yesButtonColor: '#ff6b6b' }[id];
            });
            ['hearts', 'stars', 'confetti'].forEach(id => document.getElementById(`effect-${id}`).checked = true);
            ['fireworks', 'bubbles', 'rainbow', 'snow', 'petals', 'meteor', 'lightning'].forEach(id => document.getElementById(`effect-${id}`).checked = false);
            document.getElementById('showAdminLink').checked = true;
            document.getElementById('triggerCount').value = 5;
            document.getElementById('avoidDistance').value = 100;
            ['effect-shake', 'effect-sound', 'effect-cry', 'effect-multiple', 'effect-invert'].forEach(id => document.getElementById(id).checked = true);
            document.getElementById('effect-runaway').checked = false;
            showToast('è¡¨å•å·²é‡ç½®ï¼');
        }

        /** åŠ è½½å·²ä¿å­˜åˆ—è¡¨ */
        function loadSavedList() {
            const allConfigs = JSON.parse(localStorage.getItem('loveConfigs') || '{}');
            const listContainer = document.getElementById('savedList');
            const tokens = Object.keys(allConfigs);

            if (!tokens.length) {
                listContainer.innerHTML = '<p style="color: #999; text-align: center;">æš‚æ— ä¿å­˜çš„é…ç½®</p>';
                return;
            }

            const baseUrl = window.location.origin + window.location.pathname.replace('admin.html', 'index.html');
            listContainer.innerHTML = tokens.map(token => {
                const config = allConfigs[token];
                const date = new Date(config.createdAt).toLocaleString('zh-CN');
                const link = `${baseUrl}?t=${encodeURIComponent(token)}`;
                return `
                    <div class="saved-item">
                        <div class="saved-item-info">
                            <div class="saved-item-token">å£ä»¤ï¼š${token}</div>
                            <div class="saved-item-date">åˆ›å»ºæ—¶é—´ï¼š${date}</div>
                            <div style="margin-top: 5px; font-size: 0.9rem; color: #666;">${config.question}</div>
                        </div>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <button class="btn btn-primary" style="padding: 8px 15px; font-size: 0.9rem;" onclick="window.open('${link}', '_blank')">æ‰“å¼€</button>
                            <button class="btn btn-secondary" style="padding: 8px 15px; font-size: 0.9rem;" onclick="editConfig('${token}')">ç¼–è¾‘</button>
                            <button class="btn btn-secondary" style="padding: 8px 15px; font-size: 0.9rem;" onclick="exportSingleConfig('${token}')">å¯¼å‡º</button>
                            <button class="btn btn-danger" style="padding: 8px 15px; font-size: 0.9rem;" onclick="deleteConfig('${token}')">åˆ é™¤</button>
                        </div>
                    </div>`;
            }).join('');
        }

        /** ç¼–è¾‘é…ç½® */
        function editConfig(token) {
            const allConfigs = JSON.parse(localStorage.getItem('loveConfigs') || '{}');
            const config = allConfigs[token];
            if (!config) return showToast('é…ç½®ä¸å­˜åœ¨ï¼', true);

            switchTab('create');
            document.getElementById('token').value = token;
            document.getElementById('question').value = config.question || '';
            document.getElementById('yesText').value = config.yesText || '';
            document.getElementById('noText').value = config.noText || '';
            document.getElementById('successTitle').value = config.successTitle || '';
            document.getElementById('successMessage').value = config.successMessage || '';
            document.getElementById('hints').value = (config.hints || []).join('\n');
            
            if (config.theme) {
                document.getElementById('primaryColor').value = config.theme.primaryColor || '#667eea';
                document.getElementById('secondaryColor').value = config.theme.secondaryColor || '#764ba2';
                document.getElementById('accentColor').value = config.theme.accentColor || '#f093fb';
                document.getElementById('yesButtonColor').value = config.theme.yesButtonColor || '#ff6b6b';
            }
            
            if (config.effects) {
                Object.keys(config.effects).forEach(key => {
                    const checkbox = document.getElementById(`effect-${key}`);
                    if (checkbox) checkbox.checked = config.effects[key];
                });
            }

            if (config.showAdminLink !== undefined) {
                document.getElementById('showAdminLink').checked = config.showAdminLink;
            }

            if (config.triggerEffects) {
                document.getElementById('triggerCount').value = config.triggerEffects.triggerCount || 5;
                document.getElementById('avoidDistance').value = config.triggerEffects.avoidDistance || 100;
                if (config.triggerEffects.shake !== undefined) document.getElementById('effect-shake').checked = config.triggerEffects.shake;
                if (config.triggerEffects.sound !== undefined) document.getElementById('effect-sound').checked = config.triggerEffects.sound;
                if (config.triggerEffects.cry !== undefined) document.getElementById('effect-cry').checked = config.triggerEffects.cry;
                if (config.triggerEffects.runaway !== undefined) document.getElementById('effect-runaway').checked = config.triggerEffects.runaway;
                if (config.triggerEffects.multiple !== undefined) document.getElementById('effect-multiple').checked = config.triggerEffects.multiple;
                if (config.triggerEffects.invert !== undefined) document.getElementById('effect-invert').checked = config.triggerEffects.invert;
            }
            
            showToast('é…ç½®å·²åŠ è½½ï¼Œå¯è¿›è¡Œç¼–è¾‘ï¼');
        }

        /** åˆ é™¤é…ç½® */
        function deleteConfig(token) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤å£ä»¤ "${token}" çš„é…ç½®å—ï¼Ÿ`)) return;
            const allConfigs = JSON.parse(localStorage.getItem('loveConfigs') || '{}');
            delete allConfigs[token];
            localStorage.setItem('loveConfigs', JSON.stringify(allConfigs));
            showToast('é…ç½®å·²åˆ é™¤ï¼');
            loadSavedList();
        }

        /** æç¤ºæ¶ˆæ¯ */
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show' + (isError ? ' error' : '');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        /** å¯¼å‡ºå…¨éƒ¨é…ç½® */
        function exportAllConfigs() {
            const allConfigs = JSON.parse(localStorage.getItem('loveConfigs') || '{}');
            if (Object.keys(allConfigs).length === 0) {
                return showToast('æ²¡æœ‰å¯å¯¼å‡ºçš„é…ç½®ï¼', true);
            }
            
            const blob = new Blob([JSON.stringify(allConfigs, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `love_configs_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('é…ç½®å¯¼å‡ºæˆåŠŸï¼');
        }

        /** å¯¼å‡ºå•ä¸ªé…ç½® */
        function exportSingleConfig(token) {
            const allConfigs = JSON.parse(localStorage.getItem('loveConfigs') || '{}');
            const config = allConfigs[token];
            if (!config) return showToast('é…ç½®ä¸å­˜åœ¨ï¼', true);
            
            const blob = new Blob([JSON.stringify({ [token]: config }, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `love_config_${token}_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('é…ç½®å¯¼å‡ºæˆåŠŸï¼');
        }

        /** å¯¼å…¥é…ç½® */
        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    const allConfigs = JSON.parse(localStorage.getItem('loveConfigs') || '{}');
                    
                    let count = 0;
                    for (const key in imported) {
                        if (imported[key] && typeof imported[key] === 'object') {
                            allConfigs[key] = imported[key];
                            count++;
                        }
                    }
                    
                    localStorage.setItem('loveConfigs', JSON.stringify(allConfigs));
                    loadSavedList();
                    showToast(`æˆåŠŸå¯¼å…¥ ${count} ä¸ªé…ç½®ï¼`);
                } catch (err) {
                    showToast('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼', true);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
    </script>
</body>
</html>
